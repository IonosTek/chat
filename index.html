<!DOCTYPE html>
<html>
<head>
    <title>DX Cluster Chat TSSBUG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* สไตล์ย้อนยุคแบบ ON4KST */
        body { margin: 0; font-family: 'Courier New', Courier, monospace; background-color: #f0f0f0; display: flex; flex-direction: column; height: 100vh; }
        
        /* ส่วน Login */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ddd; display: flex; justify-content: center; align-items: center; z-index: 99; }
        #login-box { background: #fff; padding: 20px; border: 2px solid #000; text-align: center; }
        
        /* Layout หลัก */
        #main-container { display: flex; flex: 1; overflow: hidden; display: none; } /* ซ่อนไว้ก่อน Login */
        
        /* พื้นที่แชท (ซ้าย) */
        #chat-area { flex: 3; background-color: #ffffcc; border-right: 2px solid #999; overflow-y: scroll; padding: 10px; display: flex; flex-direction: column; }
        .message-line { border-bottom: 1px dotted #ccc; padding: 2px 0; font-size: 14px; }
        .time { color: #000080; font-weight: bold; margin-right: 5px; }
        .user { color: #800000; font-weight: bold; margin-right: 5px; }
        .msg { color: #000; }

        /* พื้นที่รายชื่อคนออนไลน์ (ขวา) */
        #user-list-area { flex: 1; background-color: #e0e0e0; padding: 10px; overflow-y: auto; }
        #user-list-area h3 { margin-top: 0; border-bottom: 2px solid #000; font-size: 16px; }
        .online-user { color: #006400; font-weight: bold; display: block; }

        /* กล่องพิมพ์ข้อความ (ล่าง) */
        #input-area { background: #ccc; padding: 10px; display: flex; border-top: 2px solid #999; display: none; }
        #input { flex: 1; padding: 5px; font-family: 'Courier New', monospace; }
        button { padding: 5px 15px; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div id="login-box">
            <h2>DX CHAT LOGIN</h2>
            <input id="callsign-input" placeholder="Enter Callsign (e.g. HS1ABC)" style="text-transform: uppercase;">
            <button onclick="login()">Connect</button>
        </div>
    </div>

    <div id="main-container">
        <div id="chat-area"></div>
        <div id="user-list-area">
            <h3>Stations Online</h3>
            <div id="users"></div>
        </div>
    </div>

    <form id="input-area" action="">
        <input id="input" autocomplete="off" placeholder="Type message..." /><button>Send</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var myCallsign = "";

        function login() {
            var input = document.getElementById('callsign-input');
            if (input.value.trim() !== "") {
                myCallsign = input.value.toUpperCase();
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-container').style.display = 'flex';
                document.getElementById('input-area').style.display = 'flex';
                
                // ส่งชื่อให้ Server
                socket.emit('join', myCallsign);
            }
        }

        var form = document.getElementById('input-area');
        var input = document.getElementById('input');
        var chatArea = document.getElementById('chat-area');
        var usersDiv = document.getElementById('users');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        // รับข้อความ
        socket.on('chat message', function(data) {
            var item = document.createElement('div');
            item.className = 'message-line';
            // Format: [TIME] CALLSIGN: MESSAGE
            item.innerHTML = `<span class="time">[${data.time}z]</span> <span class="user">&lt;${data.user}&gt;</span> <span class="msg">${data.msg}</span>`;
            chatArea.appendChild(item);
            chatArea.scrollTop = chatArea.scrollHeight; // เลื่อนลงล่างสุดเสมอ
        });

        // อัปเดตรายชื่อคน
        socket.on('user list', function(users) {
            usersDiv.innerHTML = "";
            users.forEach(function(u) {
                var div = document.createElement('div');
                div.className = 'online-user';
                div.textContent = u;
                usersDiv.appendChild(div);
            });
        });
    </script>
</body>

</html>
