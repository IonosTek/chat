<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IonosTek Link</title>
    <style>
        /* --- GLOBAL STYLES --- */
        body { margin: 0; background-color: #0f172a; font-family: 'Segoe UI', sans-serif; color: white; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        
        /* --- LOGIN SCREEN --- */
        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%; }
        .card { background-color: #1e293b; padding: 40px; border-radius: 12px; text-align: center; width: 320px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #334155; border: 1px solid #475569; color: white; border-radius: 6px; box-sizing: border-box; text-align: center; }
        button { width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #2563eb; }

        /* --- CHAT SCREEN (Hidden by default) --- */
        #chat-screen { display: none; flex-direction: column; width: 100%; max-width: 600px; height: 100%; background: #1e293b; border-left: 1px solid #334155; border-right: 1px solid #334155; }
        #header { padding: 15px; background: #0f172a; border-bottom: 1px solid #334155; text-align: center; font-weight: bold; letter-spacing: 1px; }
        
        #messages { flex: 1; list-style-type: none; margin: 0; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        /* Message Bubbles */
        .msg { padding: 10px 15px; border-radius: 8px; max-width: 80%; word-wrap: break-word; font-size: 14px; }
        .msg.system { align-self: center; background: transparent; color: #64748b; font-size: 12px; font-style: italic; }
        .msg.others { align-self: flex-start; background: #334155; }
        .msg.me { align-self: flex-end; background: #3b82f6; }
        .username { font-weight: bold; font-size: 11px; margin-bottom: 2px; color: #94a3b8; display: block; }

        /* Input Area */
        #form { display: flex; padding: 10px; background: #0f172a; border-top: 1px solid #334155; }
        #input-msg { flex: 1; text-align: left; margin: 0; margin-right: 10px; }
        #send-btn { width: 80px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card">
            <h2>IONOSTEK</h2>
            <p style="color:#94a3b8; font-size:14px;">Secure Channel</p>
            <input id="username" placeholder="Enter Callsign / Name" autocomplete="off" />
            <button id="join-btn">CONNECT</button>
        </div>
    </div>

    <div id="chat-screen">
        <div id="header">FREQUENCY: 145.000 MHz</div>
        <ul id="messages"></ul>
        <form id="form" action="">
            <input id="input-msg" autocomplete="off" placeholder="Type a message..." />
            <button id="send-btn">SEND</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // Elements
        const loginScreen = document.getElementById('login-screen');
        const chatScreen = document.getElementById('chat-screen');
        const usernameInput = document.getElementById('username');
        const joinBtn = document.getElementById('join-btn');
        const form = document.getElementById('form');
        const inputMsg = document.getElementById('input-msg');
        const messages = document.getElementById('messages');

        let myName = "";

        // --- STEP 1: JOIN ---
        function joinChat() {
            const name = usernameInput.value.trim();
            if (name) {
                myName = name;
                socket.emit('join', name); // Tell server we are here
                loginScreen.style.display = 'none'; // Hide login
                chatScreen.style.display = 'flex';  // Show chat
                inputMsg.focus();
            }
        }

        joinBtn.addEventListener('click', joinChat);
        usernameInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') joinChat(); });

        // --- STEP 2: SEND MESSAGE ---
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (inputMsg.value) {
                socket.emit('chat message', inputMsg.value);
                inputMsg.value = '';
            }
        });

        // --- STEP 3: RECEIVE MESSAGE ---
        socket.on('chat message', function(data) {
            const item = document.createElement('li');
            
            // Check who sent it to style appropriately
            if (data.user === myName) {
                item.className = 'msg me';
                item.innerHTML = `${data.text}`;
            } else {
                item.className = 'msg others';
                item.innerHTML = `<span class="username">${data.user}</span>${data.text}`;
            }
            
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight); // Auto scroll down
        });

        // System messages (Join/Leave)
        socket.on('system message', function(msg) {
            const item = document.createElement('li');
            item.className = 'msg system';
            item.textContent = msg;
            messages.appendChild(item);
        });
    </script>
</body>
</html>
